<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="闭包是指在 JavaScript 中，内部函数总是可以访问其所在的外部函数中声明的参数和变量，即使在其外部函数被返回（寿命终结）了之后。"/>







  <link rel="alternate" href="/default" title="Hexo">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.4.x" />



<link rel="canonical" href="http://yoursite.com/2016/08/29/JavaScript之理解闭包/"/>


<meta name="description" content="闭包是指在 JavaScript 中，内部函数总是可以访问其所在的外部函数中声明的参数和变量，即使在其外部函数被返回（寿命终结）了之后。">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript之理解闭包">
<meta property="og:url" content="http://yoursite.com/2016/08/29/JavaScript之理解闭包/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="闭包是指在 JavaScript 中，内部函数总是可以访问其所在的外部函数中声明的参数和变量，即使在其外部函数被返回（寿命终结）了之后。">
<meta property="og:updated_time" content="2017-03-29T14:24:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript之理解闭包">
<meta name="twitter:description" content="闭包是指在 JavaScript 中，内部函数总是可以访问其所在的外部函数中声明的参数和变量，即使在其外部函数被返回（寿命终结）了之后。">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.4.x" />







<script>
  var CONFIG = {
    search: false,
    searchPath: "/search.xml",
    fancybox: false,
    toc: true,
  }
</script>




  



    <title> JavaScript之理解闭包 · Hexo </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Hexo</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Hexo</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          JavaScript之理解闭包
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Aug 29, 2016
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一个简单的闭包"><span class="toc-text">一个简单的闭包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#理解闭包"><span class="toc-text">理解闭包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#闭包的用途"><span class="toc-text">闭包的用途</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#闭包的循环陷阱及补救方法"><span class="toc-text">闭包的循环陷阱及补救方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结："><span class="toc-text">总结：</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <h2 id="一个简单的闭包"><a href="#一个简单的闭包" class="headerlink" title="一个简单的闭包"></a>一个简单的闭包</h2><p>例1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function sayHello(name) &#123;</div><div class="line">  var text = &apos;Hello &apos; + name;</div><div class="line">  var say = function() &#123; console.log(text); &#125;  </div><div class="line">  //say()是个内部函数，</div><div class="line">  //a closures use variable declared in the parent function </div><div class="line">  say();</div><div class="line">&#125;</div><div class="line">sayHello(&apos;Joe&apos;);</div></pre></td></tr></table></figure>
<h2 id="理解闭包"><a href="#理解闭包" class="headerlink" title="理解闭包"></a>理解闭包</h2><p>闭包是指在 JavaScript 中，内部函数总是可以访问其所在的外部函数中声明的参数和变量，即使在其外部函数被返回（寿命终结）了之后。</p>
<p>闭包是一个集合（combination）；它由两部分组成：函数，以及<strong>创建</strong>该函数的环境。环境由闭包创建时在作用域中的任何局部变量组成。可以赋值给某个变量，可以作为参数传递给函数，也可以作为一个函数返回值返回。</p>
<p>在我们的例子中say就是个闭包，因为它含有创建函数的环境，而环境中有着被定义的变量 text，所以它能使用该变量。</p>
<h2 id="闭包的用途"><a href="#闭包的用途" class="headerlink" title="闭包的用途"></a>闭包的用途</h2><p> 可以访问函数内部的量，闭包允许将函数与其所操作的某些数据（环境）关连起来。这显然类似于面向对象编程。在面对象编程中，对象允许我们将某些数据（对象的属性）与一个或者多个方法相关联。</p>
<p>因而，一般说来，可以使用只有一个方法的对象的地方，都可以使用闭包</p>
<p>例2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">function makeAdder(x) &#123;</div><div class="line">  return function(y) &#123;</div><div class="line">    return x + y;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var add5 = makeAdder(5);  //闭包</div><div class="line">var add10 = makeAdder(10);  //闭包</div><div class="line"></div><div class="line">console.log(add5(2));  // 7</div><div class="line">console.log(add10(2)); // 12</div></pre></td></tr></table></figure>
<p>例3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">var invrement,decrement,value;</div><div class="line"></div><div class="line">var makeCounter = function() &#123;</div><div class="line">  var privateCounter = 0;</div><div class="line">  increment = function ()&#123;</div><div class="line">    privateCounter += 1;</div><div class="line">  &#125;;</div><div class="line">  decrement = function ()&#123;</div><div class="line">    privateCounter -= 1;</div><div class="line">  &#125;;</div><div class="line">  setCounter = function (x) &#123;</div><div class="line">    privateCounter = x;</div><div class="line">  &#125;;</div><div class="line">  value = function () &#123;</div><div class="line">    return privateCounter;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">makeCounter();</div><div class="line">increment();</div><div class="line">console.log(value());  //1</div><div class="line"></div><div class="line">setCounter(5);</div><div class="line">console.log(value());  //5</div><div class="line"></div><div class="line">var oldCounter = value;</div><div class="line"></div><div class="line">makeCounter();</div><div class="line">decrement();</div><div class="line">console.log(value());  //-1</div><div class="line"></div><div class="line">console.log(oldCounter());  //5</div></pre></td></tr></table></figure>
<p>从例3我们可以看到，setupSomeGlobals每次执行，都会重新创建一个闭包。而且两个闭包互不影响。即它们具有独立性。</p>
<p>我们将例3稍稍改变一下，就可以看到如何用闭包<strong>模仿私有方法</strong></p>
<p>例4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">var makeCounter = function() &#123;</div><div class="line">  var privateCounter = 0;</div><div class="line">  function changeBy(val) &#123;</div><div class="line">    privateCounter += val;</div><div class="line">  &#125;</div><div class="line">  return &#123;</div><div class="line">    increment: function() &#123;</div><div class="line">      changeBy(1);</div><div class="line">    &#125;,</div><div class="line">    decrement: function() &#123;</div><div class="line">      changeBy(-1);</div><div class="line">    &#125;,</div><div class="line">    setCouter: function(x) &#123;</div><div class="line">      privateCounter = x;</div><div class="line">    &#125;,</div><div class="line">    value: function() &#123;</div><div class="line">      return privateCounter;</div><div class="line">    &#125;</div><div class="line">  &#125;  </div><div class="line">&#125;;</div><div class="line"></div><div class="line">var Counter1 = makeCounter();</div><div class="line">var Counter2 = makeCounter();</div><div class="line">console.log(Counter1.value()); /* logs 0 */</div><div class="line">Counter1.increment();</div><div class="line">Counter1.increment();</div><div class="line">console.log(Counter1.value()); /* logs 2 */</div><div class="line">Counter1.decrement();</div><div class="line">console.log(Counter1.value()); /* logs 1 */</div><div class="line">console.log(Counter2.value()); /* logs 0 */</div></pre></td></tr></table></figure>
<p>在例4中，changeBy就是一个私有方法，无法从外部直接调用。</p>
<p>另一特点就是 保存变量。这是通俗的说法。</p>
<p>从根本上说，闭包是函数开始执行的时候被分配的一个<a href="http://baike.baidu.com/link?url=x9za8fl-K8Gsdc0IFBbC5fTininX3H8qVBuSPsChIJd8bmzTRXvd8scDL1uCYKLS26m6GMbXgHFC5K8yXz7nZ3eImibufpfwiBWzlBDAyT_" target="_blank" rel="external">栈帧</a>，在函数执行结束返回后仍不会被释放(就好像一个栈帧被分配在堆里而不是栈里！)</p>
<p>例5 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">function say667() &#123;</div><div class="line">  var num = 42;</div><div class="line">    num+=1;</div><div class="line">  </div><div class="line">  var say3 = function() &#123;</div><div class="line">    console.log(num+=1);</div><div class="line">  &#125;;</div><div class="line">  say3();</div><div class="line">  var say4 = function() &#123;</div><div class="line">    console.log(num+=1);</div><div class="line">  &#125;;</div><div class="line">  return say4;</div><div class="line">&#125;</div><div class="line">say667(); //44</div><div class="line">say667(); //44，并未自增，是因为这又重新创建了一个闭包。</div><div class="line">var sayt = say667(); //44</div><div class="line">sayt(); //45</div><div class="line">sayt(); //46， 自增了，是因为say667并未重新创建闭包。</div><div class="line">         //sayt引用了里面的闭包，而且造成了num的值被保存了。在函数执行完后并未被销毁。</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：正是因为闭包有这些特点，它给我们带来了便利。但我们仍需要<br>小心使用。它有两个缺点：</p>
<ul>
<li>1、由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除；</li>
<li>2、闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。</li>
</ul>
</blockquote>
<h2 id="闭包的循环陷阱及补救方法"><a href="#闭包的循环陷阱及补救方法" class="headerlink" title="闭包的循环陷阱及补救方法"></a>闭包的循环陷阱及补救方法</h2><p>例6</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var arr = [];</div><div class="line">for(var i=0;i&lt;3;i++) &#123;</div><div class="line"> arr.push(function()&#123;console.log(i);&#125;);</div><div class="line"> &#125; </div><div class="line">arr[0](); //?</div><div class="line">arr[1](); //?</div><div class="line">arr[2](); //?</div></pre></td></tr></table></figure>
<p>例6输出的结果：三个 “3” ，详情解析可以看这个<a href="https://www.zhihu.com/question/33468703" target="_blank" rel="external">知乎问答</a>，里面有人解释的很清楚。简要来说就是，由于执行顺序的关系，在三个闭包执行前，for循环早已循环完毕（for循环没有块级作用域），i 已经自增到3。到闭包执行时，取到的i自然是3。</p>
<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//方案一</div><div class="line">for(var i=0,arr=[];i&lt;3;i++) &#123;</div><div class="line">		arr.push(</div><div class="line">  //既然是执行顺序的问题，那我们给闭包加上一个自执行函数</div><div class="line">  //内部函数引用自执行函数传入的 i ，这里的 i</div><div class="line"> 是正常的</div><div class="line">			(function(i)&#123;</div><div class="line">				return function()&#123;</div><div class="line">					console.log(i);</div><div class="line">				&#125;</div><div class="line">			&#125;)(i)</div><div class="line">		);</div><div class="line">	&#125;</div><div class="line">arr[0](); //0</div><div class="line">arr[1](); //1</div><div class="line">arr[2](); //2</div><div class="line"></div><div class="line">//方案2</div><div class="line">for(let i=0,arr=[];i&lt;3;i++)</div><div class="line">//把 i 的定义换成 let 就行，因为 let 定义的变量具有块级作用域，同样解决了这个问题</div></pre></td></tr></table></figure>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><ul>
<li>闭包是指在 JavaScript 中，内部函数总是可以访问其所在的外部函数中声明的参数和变量，即使在其外部函数被返回（寿命终结）了之后。</li>
<li>每当你在另一个函数里使用了关键字function，一个闭包就被创建了</li>
<li>JavaScript中的闭包，就像一个副本，将某函数在退出时候的所有局部变量复制保存其中。</li>
<li>使用闭包前，需要性能考量</li>
</ul>
<hr>
<p>参考文章：</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures#Performance_considerations" target="_blank" rel="external">闭包 —MDN</a></li>
<li><a href="https://segmentfault.com/a/1190000006150835" target="_blank" rel="external">Javascript中this与闭包学习笔记</a></li>
<li><a href="https://gold.xitu.io/post/58832fe72f301e00697b672d" target="_blank" rel="external">JavaScript 闭包入门（译文）</a></li>
<li><a href="http://imweb.io/topic/566567e4d91952db73b41f5d" target="_blank" rel="external">JavaScript的闭包</a></li>
<li><a href="https://www.zhihu.com/question/33468703" target="_blank" rel="external">js关于for循环中的闭包问题？</a></li>
</ul>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>Author: </span>
      <span>John Doe</span>
    </p>
    <p class="copyright-item">
      <span>Origin: </span>
      <a href="http://yoursite.com">http://yoursite.com</a>
    </p>
    <p class="copyright-item">
      <span>Link: </span>
      <a href="http://yoursite.com/2016/08/29/JavaScript之理解闭包/">http://yoursite.com/2016/08/29/JavaScript之理解闭包/</a>
    </p>

    <p class="copyright-item lincese">
      
      本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
    </p>
  </div>



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">Reward</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/wechat.jpeg" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/alipay.jpeg" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/08/29/JavaScript之深入理解this/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">JavaScript之深入理解this</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2016/09/04/CSS系列之Flexbox布局/">
        <span class="next-text nav-default">CSS系列之Flexbox布局</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:howell95@outlook.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/Howell5" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
    
    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2016 - 
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">John Doe</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2016/08/29/JavaScript之理解闭包/';
        this.page.identifier = '2016/08/29/JavaScript之理解闭包/';
        this.page.title = 'JavaScript之理解闭包';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//howell5.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  




    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.4.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.4.x"></script>

    
  </body>
</html>
